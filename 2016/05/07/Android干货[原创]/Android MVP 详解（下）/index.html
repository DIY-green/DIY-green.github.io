<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Android,MVP,详解,干货," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="作者：李旺成时间：2016年4月3日

上篇
5. 最佳实践好了终于要点讲自己的东西了，有点小激动。下面这些仅表示个人观点，非一定之规，各位看官按需取用，有说的不对的，敬请谅解。关于命名规范可以参考我的另一篇文章“Android 编码规范”。老规矩先上图：
在参考了 kenjuwagatsuma 的 MVP Architecture in Android Development 和 Saúl Mo">
<meta property="og:type" content="article">
<meta property="og:title" content="Android MVP 详解（下）">
<meta property="og:url" content="http://diy-green.com/2016/05/07/Android干货[原创]/Android MVP 详解（下）/index.html">
<meta property="og:site_name" content="DIY-green">
<meta property="og:description" content="作者：李旺成时间：2016年4月3日

上篇
5. 最佳实践好了终于要点讲自己的东西了，有点小激动。下面这些仅表示个人观点，非一定之规，各位看官按需取用，有说的不对的，敬请谅解。关于命名规范可以参考我的另一篇文章“Android 编码规范”。老规矩先上图：
在参考了 kenjuwagatsuma 的 MVP Architecture in Android Development 和 Saúl Mo">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_1.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_2.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_3.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_4.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_5.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_6.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_7.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_8.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_9.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_10.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_11.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_12.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_13.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_14.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_15.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_16.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_17.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_18.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_19.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_20.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_21.png">
<meta property="og:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_22.png">
<meta property="og:updated_time" content="2016-04-26T01:01:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android MVP 详解（下）">
<meta name="twitter:description" content="作者：李旺成时间：2016年4月3日

上篇
5. 最佳实践好了终于要点讲自己的东西了，有点小激动。下面这些仅表示个人观点，非一定之规，各位看官按需取用，有说的不对的，敬请谅解。关于命名规范可以参考我的另一篇文章“Android 编码规范”。老规矩先上图：
在参考了 kenjuwagatsuma 的 MVP Architecture in Android Development 和 Saúl Mo">
<meta name="twitter:image" content="http://diy-green.com/\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_1.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'DIY-green'
    }
  };
</script>

  <title> Android MVP 详解（下） | DIY-green </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?af1b7efbf565bc568165c5a0600a0207";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <div style="display: none;">
    <script src="http://s6.cnzz.com/stat.php?id=1258791461&web_id=1258791461" type="text/javascript"></script>
  </div>





  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">DIY-green</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            全部
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-androidstudydemo">
          <a href="/categories/AndroidStudyDemo/" rel="section">
            
              <i class="menu-item-icon fa fa-hand-right fa-fw"></i> <br />
            
            ● &nbsp; AndroidStudyDemo
          </a>
        </li>
      
        
        <li class="menu-item menu-item-androidganhuo">
          <a href="/categories/Android干货/" rel="section">
            
              <i class="menu-item-icon fa fa-hand-right fa-fw"></i> <br />
            
            ● &nbsp; Android干货
          </a>
        </li>
      
        
        <li class="menu-item menu-item-androidhacks">
          <a href="/categories/Android小技巧/" rel="section">
            
              <i class="menu-item-icon fa fa-hand-right fa-fw"></i> <br />
            
            ● &nbsp; Android小技巧
          </a>
        </li>
      
        
        <li class="menu-item menu-item-androidstudio">
          <a href="/categories/AndroidStudio/" rel="section">
            
              <i class="menu-item-icon fa fa-hand-right fa-fw"></i> <br />
            
            ● &nbsp; AndroidStudio
          </a>
        </li>
      
        
        <li class="menu-item menu-item-essay">
          <a href="/categories/随笔/" rel="section">
            
              <i class="menu-item-icon fa fa-hand-right fa-fw"></i> <br />
            
            ● &nbsp; 随笔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android MVP 详解（下）
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-07T20:39:24+08:00" content="2016-05-07">
              2016-05-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android干货/" itemprop="url" rel="index">
                    <span itemprop="name">Android干货</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android干货/原创/" itemprop="url" rel="index">
                    <span itemprop="name">原创</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/07/Android干货[原创]/Android MVP 详解（下）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/07/Android干货[原创]/Android MVP 详解（下）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
		  &nbsp; | &nbsp;
             <span id="/2016/05/07/Android干货[原创]/Android MVP 详解（下）/" class="leancloud_visitors" data-flag-title="Android MVP 详解（下）">
               
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          
		  
		  <!--<span id="busuanzi_container_page_pv">
		    &nbsp; | &nbsp;<span id="busuanzi_value_page_pv"></span>阅读
		  </span>
		  
		  
			&nbsp; | &nbsp;
			<span id="/2016/05/07/Android干货[原创]/Android MVP 详解（下）/"class="leancloud_visitors" data-flag-title="Android MVP 详解（下）">
					 &nbsp;阅读
					</span>
			-->

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>作者：<a href="https://github.com/DIY-green/" target="_blank" rel="external">李旺成</a></strong><br><strong>时间：2016年4月3日</strong></p>
<hr>
<p><a href="http://www.jianshu.com/p/9a6845b26856" target="_blank" rel="external">上篇</a></p>
<h1 id="5-最佳实践"><a href="#5-最佳实践" class="headerlink" title="5. 最佳实践"></a>5. 最佳实践</h1><p>好了终于要点讲自己的东西了，有点小激动。下面这些仅表示个人观点，非一定之规，各位看官按需取用，有说的不对的，敬请谅解。关于命名规范可以参考我的另一篇文章“<a href="http://www.jianshu.com/p/0a984f999592#" target="_blank" rel="external">Android 编码规范</a>”。老规矩先上图：</p>
<p><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_1.png" alt="MVPBestPractice 思维导图" title="MVPBestPractice 思维导图"><br>在参考了 <a href="https://medium.com/@kenjuwagatsuma" target="_blank" rel="external">kenjuwagatsuma</a> 的 <a href="https://medium.com/@kenjuwagatsuma/mvp-architecture-in-android-development-3d63cc32707a#.9fyw4pjdg" target="_blank" rel="external">MVP Architecture in Android Development</a> 和 <a href="http://saulmm.github.io/" target="_blank" rel="external">Saúl Molinero</a> 的 <a href="http://saulmm.github.io/2015/02/02/A-useful-stack-on-android-1,-architecture/" target="_blank" rel="external">A useful stack on android #1, architecture</a> 之后，我决定采用如下的分层方案来构建这个演示Demo，如下：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_2.png" alt="分层架构方案" title="分层架构方案"><br>总体架构可以被分成四个部分 ：<br><strong>Presentation</strong>：负责展示图形界面，并填充数据，该层囊括了 View 和 Presenter （上图所示的Model我理解为 ViewModel – 为 View 提供数据的 Model，或称之为 VO – View Object）。</p>
<p><strong>Domain</strong>：负责实现app的业务逻辑，该层中由普通的Java对象组成，一般包括 Usecases 和 Business Logic。</p>
<p><strong>Data</strong>：负责提供数据，这里采用了 Repository 模式，Repository 是仓库管理员，Domain 需要什么东西只需告诉仓库管理员，由仓库管理员把东西拿给它，并不需要知道东西实际放在哪。Android 开发中常见的数据来源有，RestAPI、SQLite数据库、本地缓存等。</p>
<p><strong>Library</strong>：负责提供各种工具和管理第三方库，现在的开发一般离不开第三方库（当然可以自己实现，但是不要重复造轮子不是吗？），这里建议在统一的地方管理（那就是建一个单独的 module），尽量保证和 Presentation 层分开。</p>
<p><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_3.png" alt="AndroidStudio 中构建项目" title="AndroidStudio 中构建项目"></p>
<h2 id="5-1-关于包结构划分"><a href="#5-1-关于包结构划分" class="headerlink" title="5.1. 关于包结构划分"></a>5.1. 关于包结构划分</h2><p>一个项目是否好扩展，灵活性是否够高，包结构的划分方式占了很大比重。很多项目里面喜欢采用按照特性分包（就是Activity、Service等都分别放到一个包下），在模块较少、页面不多的时候这没有任何问题；但是对于模块较多，团队合作开发的项目中，这样做会很不方便。所以，我的建议是<strong>按照模块划分包结构</strong>。</p>
<p>其实这里主要是针对 Presentation 层了，这个演示 Demo 我打算分为四个模块：登录，首页，查询天气和我的（这里仅仅是为了演示需要，具体如何划分模块还得根据具体的项目，具体情况具体分析了）。</p>
<p>划分好包之后如下图所示：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_4.png" alt="包结构划分" title="包结构划分"></p>
<h2 id="5-2-关于res拆分"><a href="#5-2-关于res拆分" class="headerlink" title="5.2. 关于res拆分"></a>5.2. 关于res拆分</h2><p>功能越来越多，项目越做越大，导致资源文件越来越多，虽然通过命名可以对其有效归类（如：通过添加模块名前缀），但文件多了终究不方便。得益于 Gradle，我们也可以对 res 目录进行拆分，先来看看拆分后的效果：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_5.png" alt="按模块拆分 res 目录" title="按模块拆分 res 目录"><br><strong>注意</strong>：resource 目录的命名纯粹是个人的命名偏好，该目录的作用是用来存放那些不需要分模块放置的资源。<br>res 目录的拆分步骤如下：<br>1) 首先打开 <strong>module 的 build.gradle</strong> 文件<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_6.png" alt="res 拆分 Step1" title="res 拆分 Step1"><br>2) 定位到 <strong>defaultConfig {}</strong> 与 <strong>buildTypes {}</strong> 之间<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_7.png" alt="res 拆分 Step2" title="res 拆分 Step2"><br>3) 在第二步定位处编辑输入 <strong>sourceSets {}</strong> 内容，具体内容如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sourceSets &#123;</span><br><span class="line">	main &#123;</span><br><span class="line">		manifest.srcFile <span class="string">'src/main/AndroidManifest.xml'</span></span><br><span class="line">		java.srcDirs = [<span class="string">'src/main/java'</span>,<span class="string">'.apt_generated'</span>]</span><br><span class="line">		aidl.srcDirs = [<span class="string">'src/main/aidl'</span>,<span class="string">'.apt_generated'</span>]</span><br><span class="line">		assets.srcDirs = [<span class="string">'src/main/assets'</span>]</span><br><span class="line">		res.srcDirs =</span><br><span class="line">		[</span><br><span class="line">				<span class="string">'src/main/res/home'</span>,</span><br><span class="line">				<span class="string">'src/main/res/login'</span>,</span><br><span class="line">				<span class="string">'src/main/res/mine'</span>,</span><br><span class="line">				<span class="string">'src/main/res/weather'</span>,</span><br><span class="line">				<span class="string">'src/main/res/resource'</span>,</span><br><span class="line">				<span class="string">'src/main/res/'</span></span><br><span class="line"></span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4) 在 res 目录下按照 sourceSets 中的配置建立相应的文件夹，将原来 res 下的所有文件（夹）都移动到 resource 目录下，并在各模块中建立 layout 等文件夹，并移入相应资源，最后 <strong>Sync Project</strong> 即可。</p>
<h2 id="5-3-怎么写-Model"><a href="#5-3-怎么写-Model" class="headerlink" title="5.3. 怎么写 Model"></a>5.3. 怎么写 Model</h2><p>这里的 Model 其实贯穿了我们项目中的三个层，Presentation、Domain 和 Data。暂且称之为 Model 吧，这也我将提供 Repository 功能的层称之为 Data Layer 的缘故（有些称这一层为 Model Layer）。</p>
<p><strong>首先</strong>，谈谈我对于 Model 是怎么理解的</p>
<p>应用都离不开数据，而这些数据来源有很多，如网络、SQLite、文件等等。一个应用对于数据的操作无非就是：获取数据、编辑（修改）数据、提交数据、展示数据这么几类。从分层的思想和 JavaEE 开发中积累的经验来看，我觉得 Model 中的类需要分类。从功能上来划分，可以分出这么几类：</p>
<p><strong>VO（View Object）</strong>：<br>视图对象，用于展示层，它的作用是把某个指定页面（或组件）的所有数据封装起来。<br><strong>DTO（Data Transfer Object）</strong>：<br>数据传输对象，这个概念来源于 JavaEE 的设计模式，原来的目的是为了 EJB 的分布式应用提供粗粒度的数据实体，以减少分布式调用的次数，从而提高分布式调用的性能和降低网络负载，但在这里，我泛指用于展示层与服务层之间的数据传输对象。<br><strong>DO（Domain Object）</strong>：<br>领域对象，就是从现实世界中抽象出来的有形或无形的业务实体。<br><strong>PO（Persistent Object）</strong>：<br>持久化对象，它跟持久层（通常是关系型数据库）的数据结构形成一一对应的映射关系，如果持久层是关系型数据库，那么，数据表中的每个字段（或若干个）就对应 PO 的一个（或若干个）属性。</p>
<p><strong>注意</strong>：关于vo、dto、do、po可以参考这篇文章-“<a href="http://www.cnblogs.com/qixuejia/p/4390086.html" target="_blank" rel="external">领域驱动设计系列文章——浅析VO、DTO、DO、PO的概念、区别和用处</a>”</p>
<p>当然这些不一定都存在，这里只是列举一下，可以有这么多分类，当然列举的也不全。</p>
<p><strong>其次</strong>，要搞清楚 Domain 层和 Data 层分别是用来做什么的</p>
<p>知道 Domain 层和 Data 层的作用，然后才知道哪些 Model 该往 Data 层中写，哪些该往 Domain 层中写。<br>Data 层负责提供数据。<br>Data 层不会知道任何关于 Domain 和 Presentation 的数据。它可以用来实现和数据源（数据库，REST API或者其他源）的连接或者接口。这个层面同时也实现了整个app所需要的实体类。</p>
<p>Domain 层相对于 Presentation 层完全独立，它会实现应用的业务逻辑，并提供 Usecases。<br>Presentation 从 Domain 层获取到的数据，我的理解就是 VO 了，VO 应该可以直接使用。</p>
<blockquote>
<p><strong>注意：</strong>这里说的直接使用是指不需要经过各种转换，各种判断了，如 Activity 中某个控件的显示隐藏是根据 VO 中的 visibility 字段来决定，那么这个最好将 visibility 作为 int 型，而且，取值为VISIBLE/INVISIBLE/GONE，或者至少是 boolean 型的。</p>
</blockquote>
<p><strong>注意</strong>：这里所谓的业务逻辑可能会于 Presenter 的功能概念上有点混淆。打个比方，假如 usecase 接收到的是一个 json 串，里面包含电影的列表，那么把这个 json 串转换成 json 以及包装成一个 ArrayList，这个应当是由 usecase 来完成。而假如 ArrayList 的 size 为0，即列表为空，需要显示缺省图，这个判断和控制应当是由 Presenter 完成的。（上述观点参考自：<a href="http://saulmm.github.io/" target="_blank" rel="external">Saúl Molinero</a>）</p>
<p><strong>最后</strong>，就是关于 Data 层，采用的 <strong> Repository 模式</strong>，建议抽象出接口来，Domain 层需要感知数据是从哪里取出来的。</p>
<h2 id="5-4-怎么写-View"><a href="#5-4-怎么写-View" class="headerlink" title="5.4. 怎么写 View"></a>5.4. 怎么写 View</h2><p>先区分一下Android View、View、界面的区别<br><strong>Android View</strong>：<br>指的是继承自android.view.View的Android组件。<br><strong>View</strong>：<br>接口和实现类，接口部分用于由 Presenter 向 View 实现类通信，可以在 Android 组件中实现它。一般最好直接使用 Activity，Fragment 或自定义 View。<br><strong>界面</strong>：<br>界面是面向用户的概念。比如要在手机上进行界面间切换时，我们在代码中可以通过多种方式实现，如 Activity 到 Activity 或一个 Activity 内部的 Fragment/View 进行切换。所以这个概念基于用户的视觉，包括了所有 View 中能看到的东西。</p>
<p>那么该怎么写 View 呢？</p>
<p>在 MVP 中 View 是很薄的一层，里面不应该有业务逻辑，所以一般只提供一些 getter 和 setter 方法，供 Presenter 操作。关于 View，我有如下建议：</p>
<ol>
<li>简单的页面中直接使用 Activity/Fragment 作为 View 的实现类，然后抽取相应的接口</li>
<li>在一些有 Tab 的页面中，可以使用 Activity + Fragment ( + ViewPager) 的方式来实现，至于 ViewPager，视具体情况而定，当然也可以直接 Activity + ViewPager 或者其他的组合方式</li>
<li>在一些包含很多控件的复杂页面中，那么建议将界面拆分，抽取自定义 View，也就是一个 Activity/Fragment 包含多个 View（实现多个 View 接口）</li>
</ol>
<h2 id="5-5-怎么写-Presenter"><a href="#5-5-怎么写-Presenter" class="headerlink" title="5.5. 怎么写 Presenter"></a>5.5. 怎么写 Presenter</h2><p>Presenter 是 Android MVP 实现中争论的焦点，上篇中介绍了多种“MVP 框架”，其实都是围绕着<strong>Presenter应该怎么写</strong>。</p>
<p>有一篇专门介绍如何设计 Presenter 的文章（<a href="http://panavtec.me/modeling-presentation-layer" target="_blank" rel="external">Modeling my presentation layer</a>），个人感觉写得不错，这里借鉴了里面不少的观点，感兴趣的童鞋可以去看看。下面进入正题。</p>
<p>为什么写 Presenter 会这么纠结，我认为主要有以下几个问题：</p>
<ol>
<li>我们将 Activity/Fragment 视为 View，那么 View 层的编写是简单了，但是这有一个问题，当手机的状态发生改变时（比如旋转手机）我们应该如何处理Presenter对象，那也就是说 Presenter 也存在生命周期，并且还要“手动维护”（别急，这是引起来的，下面会细说）</li>
<li>Presenter 中应该没有 Android Framework 的代码，也就是不需要导 Framework 中的包，那么问题来了，页面跳转，显示对话框这些情况在 Presenter 中该如何完成</li>
<li>上面说 View 的时候提到复杂的页面建议通过抽取自定义 View 的方式，将页面拆分，那么这个时候要怎么建立对应的 Presenter 呢</li>
<li>View 接口是可以有多个实现的，那我们的 Presenter 该怎么写呢</li>
</ol>
<p>好，现在我将针对上面这些问题一一给出建议。</p>
<h3 id="5-5-1-关于-Presenter-生命周期的问题"><a href="#5-5-1-关于-Presenter-生命周期的问题" class="headerlink" title="5.5.1. 关于 Presenter 生命周期的问题"></a>5.5.1. 关于 Presenter 生命周期的问题</h3><p>先看图（更详细讲解可以看看这篇文章<a href="https://medium.com/@czyrux/presenter-surviving-orientation-changes-with-loaders-6da6d86ffbbf" target="_blank" rel="external">Presenter surviving orientation changes with Loaders</a>）<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_8.png" alt="Presenter生命周期" title="Presenter生命周期"><br>如上图所示，方案1和方案2都不够优雅（这也是很多“MVP 框架”采用的实现方案），而且并不完善，只适用于一些场景。而方案3，让人耳目一新，看了之后不禁想说 Loader 就是为 Presenter 准备的啊。这里我们抓住几个关键点就好了：</p>
<ul>
<li>Loader 是 <strong>Android 框架</strong>中提供的</li>
<li>Loader 在手机状态改变时是<strong>不会被销毁</strong>的</li>
<li>Loader 的生命周期是是由<strong>系统控制</strong>的，会在Activity/Fragment不再被使用后<strong>由系统回收</strong></li>
<li>Loader 与 Activity/Fragment 的生命周期绑定，所以<strong>事件会自己分发</strong></li>
<li>每一个 Activity/Fragment 持有<strong>自己的 Loader 对象</strong>的引用</li>
<li>具体怎么用，在 <a href="https://medium.com/@czyrux" target="_blank" rel="external">Antonio Gutierrez</a> 的文章已经阐述的很明白，我就不再赘述了</li>
</ul>
<blockquote>
<p>好吧，我有一点要补充，上面说的方案1和方案2不是说就没有用了，还是视具体情况而定，如果没有那么多复杂的场景，那么用更简单的方案也未尝不可。能解决问题就好，不要拘泥于这些条条框框…（话说，咱这不是为了追求完美吗，哈哈）</p>
</blockquote>
<h3 id="5-5-2-关于页面跳转和显示Dialog"><a href="#5-5-2-关于页面跳转和显示Dialog" class="headerlink" title="5.5.2. 关于页面跳转和显示Dialog"></a>5.5.2. 关于页面跳转和显示Dialog</h3><p><strong>首先，</strong>说说页面跳转，前一阵子忙着重构公司的项目，发现项目中很多地方使用 startActivity() 和使用 Intent 的 putExtra() 显得很乱；更重要的是从 Intent 中取数据的时候需要格外小心——类型要对应，key 要写对，不然轻则取不到数据，重则 Crash。</p>
<p><strong>还有一点，</strong>就是当前 Activity/Fragment 必须要知道目标 Activity 的类名，这里耦合的很严重，有没有。当时就在想这是不是应该封装一下啊，或者有更好的解决方案。于是，先在网上搜了一下，知乎上有类似的提问，有人建议写一个 Activity Router（Activity 路由表）。嗯，正好和我的思路类似，那就开干。</p>
<p>我的思路很简单，在 util 包中定义一个 NavigationManager 类，在该类中按照模块使用注释先分好区块（为什么要分区块，去看看我的 “<a href="http://www.jianshu.com/p/0a984f999592#" target="_blank" rel="external">Android 编码规范</a>”）。然后为每个模块中的 Activity 该如何跳转，定义一个静态方法。</p>
<p>如果不需要传递数据的，那就很简单了，只要传入调用者的 Context，直接 new 出 Intent，调用该 Context 的 startActivity() 方法即可。<br>代码如下：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_9.png" alt="导航管理类-跳转系统页面" title="导航管理类-跳转系统页面"><br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_10.png" alt="导航管理类-跳转不需要传递数据的页面" title="导航管理类-跳转不需要传递数据的页面"></p>
<p>如果需要传递数据呢？刚才说了，使用 Bundle 或者 putExtra() 这种方式很不优雅，而且容易出错（那好，你个给优雅的来看看，哈哈）。确实，我没想到比较优雅的方案，在这里我提供一个粗糙的方案，仅供大家参考一下，如有你有更好的，那麻烦也和我分享下。</p>
<p>我的方案是这样的，使用序列化对象来传递数据（建议使用 Parcelable，不要偷懒去用 Serializable，这个你懂的）。为需要传递数据的 Activity 新建一个实现了 Parcelable 接口的类，将要传递的字段都定义在该类中。其他页面需要跳转到该 Activity，那么就需要提供这个对象。在目标 Activity 中获取到该对象后，那就方便了，不需要去找对应的 key 来取数据了，反正只要对象中有的，你就能直接使用。</p>
<blockquote>
<p><strong>注意：</strong>这里我建议将序列化对象中的所有成员变量都定义为 public 的，一来，可以减少代码量，主要是为了减少方法数（虽说现在对于方法数超 64K 有比较成熟的 dex 分包方案，但是尽量不超不是更好）；二来，通过对象的 public 属性直接读写比使用 getter/setter 速度要快（听说的，没有验证过）。</p>
<p><strong>注意：</strong>这里建议在全局常量类（没有，那就定义一个，下面会介绍）中定义一个唯一的 INTENT_EXTRA_KEY，往 Bundle 中存和取得时候都用它，也不用去为命名 key 费神（命名从来不简单，不是吗），取的时候也不用思考是用什么 key 存的，简单又可以避免犯错。</p>
</blockquote>
<p>具体如下图所示：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_11.png" alt="导航管理类-跳转需要传递数据的页面" title="导航管理类-跳转需要传递数据的页面"><br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_12.png" alt="导航管理类-传递数据" title="导航管理类-传递数据"><br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_13.png" alt="导航管理类-获取传递的数据" title="导航管理类-获取传递的数据"><br>导航管理类代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//==========逻辑方法==========</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getParcelableExtra</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">	Parcelable parcelable = activity.getIntent().getParcelableExtra(NavigateManager.PARCELABLE_EXTRA_KEY);</span><br><span class="line">	activity = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">return</span> (T)parcelable;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">overlay</span><span class="params">(Context context, Class&lt;? extends Activity&gt; targetClazz, <span class="keyword">int</span> flags, Parcelable parcelable)</span> </span>&#123;</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(context, targetClazz);</span><br><span class="line">	setFlags(intent, flags);</span><br><span class="line">	putParcelableExtra(intent, parcelable);</span><br><span class="line">	context.startActivity(intent);</span><br><span class="line">	context = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">overlay</span><span class="params">(Context context, Class&lt;? extends Activity&gt; targetClazz, Parcelable parcelable)</span> </span>&#123;</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(context, targetClazz);</span><br><span class="line">	putParcelableExtra(intent, parcelable);</span><br><span class="line">	context.startActivity(intent);</span><br><span class="line">	context = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">overlay</span><span class="params">(Context context, Class&lt;? extends Activity&gt; targetClazz, Serializable serializable)</span> </span>&#123;</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(context, targetClazz);</span><br><span class="line">	putSerializableExtra(intent, serializable);</span><br><span class="line">	context.startActivity(intent);</span><br><span class="line">	context = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">overlay</span><span class="params">(Context context, Class&lt;? extends Activity&gt; targetClazz)</span> </span>&#123;</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(context, targetClazz);</span><br><span class="line">	context.startActivity(intent);</span><br><span class="line">	context = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">forward</span><span class="params">(Context context, Class&lt;? extends Activity&gt; targetClazz, <span class="keyword">int</span> flags, Parcelable parcelable)</span> </span>&#123;</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(context, targetClazz);</span><br><span class="line">	setFlags(intent, flags);</span><br><span class="line">	intent.putExtra(PARCELABLE_EXTRA_KEY, parcelable);</span><br><span class="line">	context.startActivity(intent);</span><br><span class="line">	<span class="keyword">if</span> (isActivity(context)) <span class="keyword">return</span>;</span><br><span class="line">	((Activity)context).finish();</span><br><span class="line">	context = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">forward</span><span class="params">(Context context, Class&lt;? extends Activity&gt; targetClazz, Parcelable parcelable)</span> </span>&#123;</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(context, targetClazz);</span><br><span class="line">	putParcelableExtra(intent, parcelable);</span><br><span class="line">	context.startActivity(intent);</span><br><span class="line">	<span class="keyword">if</span> (isActivity(context)) <span class="keyword">return</span>;</span><br><span class="line">	((Activity)context).finish();</span><br><span class="line">	context = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">forward</span><span class="params">(Context context, Class&lt;? extends Activity&gt; targetClazz, Serializable serializable)</span> </span>&#123;</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(context, targetClazz);</span><br><span class="line">	putSerializableExtra(intent, serializable);</span><br><span class="line">	context.startActivity(intent);</span><br><span class="line">	<span class="keyword">if</span> (isActivity(context)) <span class="keyword">return</span>;</span><br><span class="line">	((Activity)context).finish();</span><br><span class="line">	context = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">forward</span><span class="params">(Context context, Class&lt;? extends Activity&gt; targetClazz)</span> </span>&#123;</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(context, targetClazz);</span><br><span class="line">	context.startActivity(intent);</span><br><span class="line">	<span class="keyword">if</span> (isActivity(context)) <span class="keyword">return</span>;</span><br><span class="line">	((Activity)context).finish();</span><br><span class="line">	context = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startForResult</span><span class="params">(Context context, Class&lt;? extends Activity&gt; targetClazz, <span class="keyword">int</span> flags)</span> </span>&#123;</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(context, targetClazz);</span><br><span class="line">	<span class="keyword">if</span> (isActivity(context)) <span class="keyword">return</span>;</span><br><span class="line">	((Activity)context).startActivityForResult(intent, flags);</span><br><span class="line">	context = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startForResult</span><span class="params">(Context context, Class&lt;? extends Activity&gt; targetClazz, <span class="keyword">int</span> flags, Parcelable parcelable)</span> </span>&#123;</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(context, targetClazz);</span><br><span class="line">	<span class="keyword">if</span> (isActivity(context)) <span class="keyword">return</span>;</span><br><span class="line">	putParcelableExtra(intent, parcelable);</span><br><span class="line">	((Activity)context).startActivityForResult(intent, flags);</span><br><span class="line">	context = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setResult</span><span class="params">(Context context, Class&lt;? extends Activity&gt; targetClazz, <span class="keyword">int</span> flags, Parcelable parcelable)</span> </span>&#123;</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(context, targetClazz);</span><br><span class="line">	setFlags(intent, flags);</span><br><span class="line">	putParcelableExtra(intent, parcelable);</span><br><span class="line">	<span class="keyword">if</span> (isActivity(context)) <span class="keyword">return</span>;</span><br><span class="line">	((Activity)context).setResult(flags, intent);</span><br><span class="line">	((Activity)context).finish();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isActivity</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!(context <span class="keyword">instanceof</span> Activity)) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setFlags</span><span class="params">(Intent intent, <span class="keyword">int</span> flags)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (flags &lt; <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">	intent.setFlags(flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putParcelableExtra</span><span class="params">(Intent intent, Parcelable parcelable)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (parcelable == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">	intent.putExtra(PARCELABLE_EXTRA_KEY, parcelable);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putSerializableExtra</span><span class="params">(Intent intent, Serializable serializable)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (serializable == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">	intent.putExtra(PARCELABLE_EXTRA_KEY, serializable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>传递数据用的序列化对象，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DishesStockVO</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> isShowMask; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> pageNum; </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">describeContents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span><span class="params">(Parcel dest, <span class="keyword">int</span> flags)</span> </span>&#123;</span><br><span class="line">        dest.writeByte(isShowMask ? (<span class="keyword">byte</span>) <span class="number">1</span> : (<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line">        dest.writeInt(<span class="keyword">this</span>.pageNum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DishesStockVO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">DishesStockVO</span><span class="params">(Parcel in)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isShowMask = in.readByte() != <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.pageNum = in.readInt();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Creator&lt;DishesStockVO&gt; CREATOR = <span class="keyword">new</span> Creator&lt;DishesStockVO&gt;() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> DishesStockVO <span class="title">createFromParcel</span><span class="params">(Parcel source)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> DishesStockVO(source);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> DishesStockVO[] newArray(<span class="keyword">int</span> size) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> DishesStockVO[size];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"DishesStockVO&#123;"</span> +</span><br><span class="line">                <span class="string">"isShowMask="</span> + isShowMask +</span><br><span class="line">                <span class="string">", pageNum="</span> + pageNum +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>好像，还没入正题。这里再多说一句，beautifulSoup 写了一篇文章，说的就是 Android 路由表框架的，可以去看看——“<a href="http://sixwolf.net/blog/2016/03/23/Android%E8%B7%AF%E7%94%B1%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/" target="_blank" rel="external">Android路由框架设计与实现</a>”。</p>
<p>好了，回到主题，在 Presenter 中该如何处理页面跳转的问题。在这里我建议简单处理，在 View Interface 中定义好接口（方法），在 View 的实现类中去处理（本来就是它的责任，不是吗？）。在 View 的实现类中，使用 NavigationManager 工具类跳转，达到解耦的目的。<br>如下图所示：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_14.png" alt="对页面跳转的处理" title="对页面跳转的处理"></p>
<p><strong>显示对话框</strong><br>我在这里采用和页面跳转的处理类似的方案，这也是 View 的责任，所以让 View 自己去完成。这里建议每个模块都定义一个相应的 XxxDialogManager 类，来管理该模块所有的弹窗，当然对于弹窗本来就不多的，那就直接在 util 包中定义一个 DialogManager 类就好了。<br>如下图：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_15.png" alt="对显示对话框的处理" title="对显示对话框的处理"></p>
<h3 id="5-5-3-一个页面多个View的问题"><a href="#5-5-3-一个页面多个View的问题" class="headerlink" title="5.5.3. 一个页面多个View的问题"></a>5.5.3. 一个页面多个View的问题</h3><p>对于复杂页面，一般建议拆成多个自定义 View，那么这就引出一个问题，这时候是用一个 Presenter 好，还是定义多个 Presenter 好呢？<br>我的建议是，每个 View Interface 对应一个 Presenter，如下图所示：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_16.png" alt="一个页面多个 View 处理" title="一个页面多个 View 处理"></p>
<h3 id="5-5-4-一个View有两个实现类的问题"><a href="#5-5-4-一个View有两个实现类的问题" class="headerlink" title="5.5.4. 一个View有两个实现类的问题"></a>5.5.4. 一个View有两个实现类的问题</h3><p>有些时候会遇到这样的问题，只是展示上有差别，两个页面上所有的操作都是一样的，这就意味着 View Interface 是一样的，只是有两个实现类。</p>
<p>这个问题该怎么处理，或许可以继续使用同样的Presenter并在另一个Android组件中实现View接口。不过这个界面似乎有更多的功能，那要不要把这些新功能加进这个Presenter呢？</p>
<p>这个视情况而定，有多种方案：一是将Presenter整合负责不同操作，二是写两个Presenter分别负责操作和展示，三是写一个Presenter包含所有操作（在两个View相似时）。记住没有完美的解决方案，编程的过程就是让步的过程。（参考自：<a href="https://github.com/PaNaVTEC" target="_blank" rel="external">Christian Panadero PaNaVTEC</a> 的 <a href="http://panavtec.me/modeling-presentation-layer" target="_blank" rel="external">Modeling my presentation layer</a>）<br>如下图所示：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_17.png" alt="一个 View 多个实现类处理" title="一个 View 多个实现类处理"></p>
<h2 id="5-6-关于-RestAPI"><a href="#5-6-关于-RestAPI" class="headerlink" title="5.6. 关于 RestAPI"></a>5.6. 关于 RestAPI</h2><p>一般项目当中会用到很多和服务器端通信用的接口，这里建议在每个模块中都建立一个 api 包，在该包下来统一处理该模块下所有的 RestAPI。<br>如下图所示：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_18.png" alt="统一管理 RestAPI" title="统一管理 RestAPI"></p>
<p>对于网络请求之类需要异步处理的情况，一般都需要传入一个回调接口，来获取异步处理的结果。对于这种情况，我建议参考 onClick(View v) {} 的写法。那就是为每一个请求编一个号（使用 int 值），我称之为 taskId，可以将该编号定义在各个模块的常量类中。然后在回调接口的实现类中，可以在回调方法中根据 taskId 来统一处理（一般是在这里分发下去，分别调用不同的方法）。<br>如下图所示：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_19.png" alt="定义 taskId" title="定义 taskId"><br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_20.png" alt="异步任务回调处理" title="异步任务回调处理"></p>
<h2 id="5-7-关于项目中的常量管理"><a href="#5-7-关于项目中的常量管理" class="headerlink" title="5.7. 关于项目中的常量管理"></a>5.7. 关于项目中的常量管理</h2><p>Android 中<strong>不推荐使用枚举</strong>，<strong>推荐使用常量</strong>，我想说说项目当中我一般是怎么管理常量的。</p>
<p>灵感来自 <strong>R.java </strong> 类，这是由项目构建工具自动生成并维护的，可以进去看看，里面是一堆的静态内部类，如下图：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_21.png" alt="Android 中的 R 文件" title="Android 中的 R 文件"></p>
<p>看到这，可能大家都猜到了，那就是定义一个类来管理全局的常量数据，我一般喜欢命名为  <strong>C.java</strong>。这里有一点要注意，我们的项目是按模块划分的包，所以会有一些是该模块单独使用的常量，那么这些最好不要写到全局常量类中，否则会导致 C 类膨胀，不利于管理，最好是将这些常量定义到各个模块下面。如下图所示：<br><img src="\uploads\androidganhuo\yuanchuang\androidmvp_detail\xia\androidmvp_detail_xia_22.png" alt="全局常量 C 类" title="全局常量 C 类"></p>
<h2 id="5-8-关于第三方库"><a href="#5-8-关于第三方库" class="headerlink" title="5.8. 关于第三方库"></a>5.8. 关于第三方库</h2><p>Android 开发中不可避免要导入很多第三方库，这里我想谈谈我对第三方库的一些看法。关于第三方库的推荐我就不做介绍了，很多专门说这方面的文章。</p>
<h3 id="5-8-1-挑选第三方库的一些建议"><a href="#5-8-1-挑选第三方库的一些建议" class="headerlink" title="5.8.1. 挑选第三方库的一些建议"></a>5.8.1. 挑选第三方库的一些建议</h3><ol>
<li>项目中确实需要（这不是废话吗？用不着，我要它干嘛？呵呵，建议不要为了解决一个小小的问题导入一个大而全的库）</li>
<li>使用的人要多（大家都在用的一般更新会比较快，出现问题解决方案也多）</li>
<li>效率和体量的权衡（如果效率没有太大影响的情况下，我一般建议选择体量小点的，如，Gson vs Jackson，Gson 胜出；还是 65K 的问题） </li>
</ol>
<h3 id="5-8-2-使用第三方库尽量二次封装"><a href="#5-8-2-使用第三方库尽量二次封装" class="headerlink" title="5.8.2. 使用第三方库尽量二次封装"></a>5.8.2. 使用第三方库尽量二次封装</h3><p><strong>为什么要二次封装？</strong><br>为了方便更换，说得稍微专业点为了降低耦合。<br>有很多原因可能需要你替换项目中的第三方库，这时候如果你是经过二次封装的，那么很简单，只需要在封装类中修改一下就可以了，完全不需要去全局检索代码。<br>我就遇到过几个替换第三方库的事情：</p>
<ol>
<li>替换项目中的统计埋点工具</li>
<li>替换网络框架</li>
<li>替换日志工具</li>
</ol>
<p><strong>那该怎么封装呢？</strong><br>一般的，如果是一些第三方的工具类，都会提供一些静态方法，那么这个就简单了，直接写一个工具类，提供类似的静态方法即可（就是用静态工厂模式）。<br>如下代码所示，这是对系统 Log 的简单封装：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Description: 企业中通用的Log管理</span><br><span class="line"> * 开发阶段LOGLEVEL = 6</span><br><span class="line"> * 发布阶段LOGLEVEL = -1</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> LOGLEVEL = <span class="number">6</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> VERBOSE = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> DEBUG = <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> INFO = <span class="number">3</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> WARN = <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> ERROR = <span class="number">5</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setDevelopMode</span><span class="params">(<span class="keyword">boolean</span> flag)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(flag) &#123;</span><br><span class="line">			LOGLEVEL = <span class="number">6</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			LOGLEVEL = -<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">v</span><span class="params">(String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; VERBOSE &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			Log.v(tag, msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">d</span><span class="params">(String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; DEBUG &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			Log.d(tag, msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">i</span><span class="params">(String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; INFO &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			Log.i(tag, msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">w</span><span class="params">(String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; WARN &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			Log.w(tag, msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; ERROR &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			Log.e(tag, msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在如果想替换为 <a href="https://github.com/orhanobut" target="_blank" rel="external">orhanobut</a> 的 <a href="https://github.com/orhanobut/logger" target="_blank" rel="external">Logger</a>，那很简单，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Description: 通用的Log管理工具类</span><br><span class="line"> * 开发阶段LOGLEVEL = 6</span><br><span class="line"> * 发布阶段LOGLEVEL = -1</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> String mTag = <span class="string">"MVPBestPractice"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> LOGLEVEL = <span class="number">6</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> VERBOSE = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> DEBUG = <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> INFO = <span class="number">3</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> WARN = <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> ERROR = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		com.orhanobut.logger.Logger</span><br><span class="line">				.init(mTag)               		<span class="comment">// default PRETTYLOGGER or use just init()</span></span><br><span class="line">				.setMethodCount(<span class="number">3</span>)            	<span class="comment">// default 2</span></span><br><span class="line">				.hideThreadInfo()             	<span class="comment">// default shown</span></span><br><span class="line">				.setLogLevel(LogLevel.FULL);  	<span class="comment">// default LogLevel.FULL</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setDevelopMode</span><span class="params">(<span class="keyword">boolean</span> flag)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(flag) &#123;</span><br><span class="line">			LOGLEVEL = <span class="number">6</span>;</span><br><span class="line">			com.orhanobut.logger.Logger.init().setLogLevel(LogLevel.FULL);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			LOGLEVEL = -<span class="number">1</span>;</span><br><span class="line">			com.orhanobut.logger.Logger.init().setLogLevel(LogLevel.NONE);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">v</span><span class="params">(@NonNull String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; VERBOSE &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			tag = checkTag(tag);</span><br><span class="line"><span class="comment">//			Log.v(tag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.t(tag).v(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">d</span><span class="params">(@NonNull String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; DEBUG &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			tag = checkTag(tag);</span><br><span class="line"><span class="comment">//			Log.d(tag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.t(tag).d(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">i</span><span class="params">(@NonNull String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; INFO &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			tag = checkTag(tag);</span><br><span class="line"><span class="comment">//			Log.i(tag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.t(tag).i(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">w</span><span class="params">(@NonNull String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; WARN &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			tag = checkTag(tag);</span><br><span class="line"><span class="comment">//			Log.w(tag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.t(tag).w(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(@NonNull String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; ERROR &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			tag = checkTag(tag);</span><br><span class="line"><span class="comment">//			Log.e(tag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.t(tag).e(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(@NonNull String tag, Exception e)</span> </span>&#123;</span><br><span class="line">		tag = checkTag(tag);</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; ERROR) &#123;</span><br><span class="line"><span class="comment">//			Log.e(tag, e==null ? "未知错误" : e.getMessage());</span></span><br><span class="line">			com.orhanobut.logger.Logger.t(tag).e(e == <span class="keyword">null</span> ? <span class="string">"未知错误"</span> : e.getMessage());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">v</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; VERBOSE &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line"><span class="comment">//			Log.v(mTag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.v(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">d</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; DEBUG &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line"><span class="comment">//			Log.d(mTag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.d(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">i</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; INFO &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line"><span class="comment">//			Log.i(mTag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.i(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">w</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; WARN &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line"><span class="comment">//			Log.w(mTag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.v(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; ERROR &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line"><span class="comment">//			Log.e(mTag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.e(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; ERROR) &#123;</span><br><span class="line"><span class="comment">//			Log.e(mTag, e==null ? "未知错误" : e.getMessage());</span></span><br><span class="line">			com.orhanobut.logger.Logger.e(e == <span class="keyword">null</span> ? <span class="string">"未知错误"</span> : e.getMessage());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">wtf</span><span class="params">(@NonNull String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; INFO &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			tag = checkTag(tag);</span><br><span class="line"><span class="comment">//			Log.i(tag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.t(tag).wtf(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">json</span><span class="params">(@NonNull String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; INFO &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			tag = checkTag(tag);</span><br><span class="line"><span class="comment">//			Log.i(tag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.t(tag).json(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">xml</span><span class="params">(@NonNull String tag, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; INFO &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line">			tag = checkTag(tag);</span><br><span class="line"><span class="comment">//			Log.i(tag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.t(tag).xml(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">wtf</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; INFO &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line"><span class="comment">//			Log.i(tag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.wtf(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">json</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; INFO &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line"><span class="comment">//			Log.i(tag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.json(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">xml</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(LOGLEVEL &gt; INFO &amp;&amp; !TextUtils.isEmpty(msg)) &#123;</span><br><span class="line"><span class="comment">//			Log.i(tag, msg);</span></span><br><span class="line">			com.orhanobut.logger.Logger.xml(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">checkTag</span><span class="params">(String tag)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (TextUtils.isEmpty(tag)) &#123;</span><br><span class="line">			tag = mTag;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> tag;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里是最简单的一些替换，如果是替换网络框架，图片加载框架之类的，可能要多费点心思去封装一下，这里可以参考“门面模式”。（在这里就不展开来讲如何对第三库进行二次封装了，以后有时间专门写个帖子）</p>
<h3 id="5-8-3-建立单独的-Module-管理所有的第三库"><a href="#5-8-3-建立单独的-Module-管理所有的第三库" class="headerlink" title="5.8.3. 建立单独的 Module 管理所有的第三库"></a>5.8.3. 建立单独的 Module 管理所有的第三库</h3><p>原因前面已经说过了，而且操作也很简单。网上有不少拆分 Gradle 文件的方法，讲的都很不错。那我们就先从最简单的做起，赶快行动起来，把项目中用到的第三方库都集中到 Library Module 中来吧。</p>
<h2 id="5-9-MVP-vs-MVVM"><a href="#5-9-MVP-vs-MVVM" class="headerlink" title="5.9. MVP vs MVVM"></a>5.9. MVP vs MVVM</h2><p><strong>关于 MVP 和 MVVM </strong>我只想说一句，它们并不是相斥的。具体它们是怎么不相斥的，<a href="http://blog.zhaiyifan.cn/" target="_blank" rel="external">markzhai</a> 的这篇文章“<a href="http://blog.zhaiyifan.cn/2016/03/16/android-new-project-from-0-p3/" target="_blank" rel="external">MVPVM in Action, 谁告诉你MVP和MVVM是互斥的</a>”说得很详细。</p>
<h2 id="5-10-Code"><a href="#5-10-Code" class="headerlink" title="5.10. Code"></a>5.10. Code</h2><p>抱歉，要食言了，AndroidStudio 出了点问题，代码还没写完，代码估计要这周末才能同步到 <a href="https://github.com/DIY-green/MVPBestPractice" target="_blank" rel="external">GitHub</a> 上了，目前只上传了一个空框架。</p>
<h2 id="5-11-小结"><a href="#5-11-小结" class="headerlink" title="5.11. 小结"></a>5.11. 小结</h2><p>历时三天的 MVP 总结，总算要告一段落了。前期断断续续地花了将近一周左右零散的时间去调研 MVP，直到正式开始码字的时候才发现准备的还不够。看了很多文章，有观点一致的，也有观点很不一致的。最关键的是，自己对于 MVP 还没有比较深刻的认知，所以在各种观点中取舍花了很长时间。<br>这算得上是我第一次真正意义上的写技术性的文章，说来惭愧，工作这么长时间了，现在才开始动笔。<br>总体来说，写得并不尽如人意，套一句老话——革命尚未成功，同志仍需努力。这算是一次尝试，希望以后会越写越顺畅。在这里给各位坚持看到此处的看官们问好了，祝大家一同进步。（欢迎大家围观我的<a href="https://github.com/DIY-green" target="_blank" rel="external">GitHub</a>，周末更新，会渐渐提交更多有用的代码的）</p>
<h1 id="6-进阶与不足"><a href="#6-进阶与不足" class="headerlink" title="6. 进阶与不足"></a>6. 进阶与不足</h1><p>鉴于本人能力有限，还有很多想写的和该写的内容没有写出来，很多地方表达的也不是很清晰。下面说一说我觉得还有哪些不足和下一步要进阶的方向。</p>
<ol>
<li>说好的“show me the code”，代码呢？（再次抱歉了）</li>
<li>上篇当中关于各种 Presenter 方案只是做了简单的罗列，并没有仔细分析各个方案的优点和不足</li>
<li>没有形成自己的框架（呵呵，好高骛远了，但是梦想还是要有的…）</li>
<li>没有单元测试（项目代码都还没有呢，提倡 TDD 不是，呵呵）</li>
<li>很多细节没有介绍清楚（如关于Model、Domain、Entity 等概念不是很清晰）</li>
<li>很多引用的观点没有指明出处（如有侵权，马上删除）<br>……</li>
</ol>
<p>最后想说一句，没有完美的架构，没有完美的框架，赶紧编码吧！</p>
<h1 id="7-附录"><a href="#7-附录" class="headerlink" title="7. 附录"></a>7. 附录</h1><p><a href="http://pan.baidu.com/s/1bETicm" target="_blank" rel="external">Android MVP 总结资料汇总</a><br>附上我的思维导图：<br><a href="https://github.com/DIY-green/MVPBestPractice/blob/master/doc/MVPBestPractice.mmap" target="_blank" rel="external">MVPBestPractice.mmap</a><br><a href="https://github.com/DIY-green/MVPBestPractice/blob/master/doc/MVP%E6%80%BB%E7%BB%93.mmap" target="_blank" rel="external">MVP总结.mmap</a><br><a href="https://github.com/DIY-green/MVPBestPractice/blob/master/doc/Presenter%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.mmap" target="_blank" rel="external">Presenter生命周期.mmap</a><br><a href="https://github.com/DIY-green/MVPBestPractice/blob/master/doc/%E6%80%8E%E4%B9%88%E5%86%99Presenter.mmap" target="_blank" rel="external">怎么写Presenter.mmap</a></p>
<h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><p><a href="https://segmentfault.com/a/1190000003871577" target="_blank" rel="external">https://segmentfault.com/a/1190000003871577</a><br><a href="http://www.open-open.com/lib/view/open1450008180500.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1450008180500.html</a><br><a href="http://www.myexception.cn/android/2004698.html" target="_blank" rel="external">http://www.myexception.cn/android/2004698.html</a><br><a href="http://gold.xitu.io/entry/56cbf38771cfe40054eb3a34" target="_blank" rel="external">http://gold.xitu.io/entry/56cbf38771cfe40054eb3a34</a><br><a href="http://kb.cnblogs.com/page/531834/" target="_blank" rel="external">http://kb.cnblogs.com/page/531834/</a><br><a href="http://blog.zhaiyifan.cn/2016/03/16/android-new-project-from-0-p3/" target="_blank" rel="external">http://blog.zhaiyifan.cn/2016/03/16/android-new-project-from-0-p3/</a><br><a href="http://www.open-open.com/lib/view/open1446377609317.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1446377609317.html</a><br><a href="http://my.oschina.net/mengshuai/blog/541314?fromerr=3J2TdbiW" target="_blank" rel="external">http://my.oschina.net/mengshuai/blog/541314?fromerr=3J2TdbiW</a><br><a href="http://gold.xitu.io/entry/56fcf1f75bbb50004d872e74" target="_blank" rel="external">http://gold.xitu.io/entry/56fcf1f75bbb50004d872e74</a><br><a href="https://github.com/googlesamples/android-architecture/tree/todo-mvp-loaders/todoapp" target="_blank" rel="external">https://github.com/googlesamples/android-architecture/tree/todo-mvp-loaders/todoapp</a><br><a href="http://blog.zhaiyifan.cn/2016/03/16/android-new-project-from-0-p3/" target="_blank" rel="external">http://blog.zhaiyifan.cn/2016/03/16/android-new-project-from-0-p3/</a><br><a href="http://android.jobbole.com/82375/" target="_blank" rel="external">http://android.jobbole.com/82375/</a><br><a href="http://blog.csdn.net/weizhiai12/article/details/47904135" target="_blank" rel="external">http://blog.csdn.net/weizhiai12/article/details/47904135</a><br><a href="http://android.jobbole.com/82051/" target="_blank" rel="external">http://android.jobbole.com/82051/</a><br><a href="http://android.jobbole.com/81153/" target="_blank" rel="external">http://android.jobbole.com/81153/</a><br><a href="http://blog.chengdazhi.com/index.php/115" target="_blank" rel="external">http://blog.chengdazhi.com/index.php/115</a><br><a href="http://blog.chengdazhi.com/index.php/131" target="_blank" rel="external">http://blog.chengdazhi.com/index.php/131</a><br><a href="http://www.codeceo.com/article/android-mvp-practice.html" target="_blank" rel="external">http://www.codeceo.com/article/android-mvp-practice.html</a><br><a href="http://www.wtoutiao.com/p/h01nn2.html" target="_blank" rel="external">http://www.wtoutiao.com/p/h01nn2.html</a><br><a href="http://blog.jobbole.com/71209/" target="_blank" rel="external">http://blog.jobbole.com/71209/</a><br><a href="http://www.cnblogs.com/tianzhijiexian/p/4393722.html" target="_blank" rel="external">http://www.cnblogs.com/tianzhijiexian/p/4393722.html</a><br><a href="https://github.com/xitu/gold-miner/blob/master/TODO/things-i-wish-i-knew-before-i-wrote-my-first-android-app.md" target="_blank" rel="external">https://github.com/xitu/gold-miner/blob/master/TODO/things-i-wish-i-knew-before-i-wrote-my-first-android-app.md</a><br><a href="http://gold.xitu.io/entry/56cd79c12e958a69f944984c" target="_blank" rel="external">http://gold.xitu.io/entry/56cd79c12e958a69f944984c</a><br><a href="http://blog.yongfengzhang.com/cn/blog/write-code-that-is-easy-to-delete-not-easy-to/" target="_blank" rel="external">http://blog.yongfengzhang.com/cn/blog/write-code-that-is-easy-to-delete-not-easy-to/</a><br><a href="http://kb.cnblogs.com/page/533808/" target="_blank" rel="external">http://kb.cnblogs.com/page/533808/</a></p>

      
    </div>
    
    <div>
      
        
      
    </div>

    <div>
      
        
<div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton", disable="enable", onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}", style="cursor: pointer; border: 0; outline: 0; border-radius: 100%; padding: 0; margin: 0; letter-spacing: normal; text-transform: none; text-indent: 0px; text-shadow: none">
    <span onmouseover="this.style.color='rgb(236,96,0)';this.style.background='rgb(204,204,204)'" onMouseOut="this.style.color='#fff';this.style.background='rgb(236,96,0)'" style="display: inline-block; width: 70px; height: 70px; border-radius: 100%; line-height: 81px; color: #fff; font: 400 35px/75px 'microsofty'; background: rgb(236,96,0)">赏</span>
  </button>
  <div id="QR" style="display: none;">
    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/images/wechat-reward-image.png" alt="DIY-green WeChat Pay" style="width: 200px; max-width: 100%; display: inline-block"/>
        <p>微信打赏</p>
      </div>
    
    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/images/alipay-reward-image.png" alt="DIY-green Alipay" style="width: 200px; max-width: 100%; display: inline-block"/>
        <p>支付宝打赏</p>
      </div>
    
  </div>
</div>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag">#Android</a>
          
            <a href="/tags/MVP/" rel="tag">#MVP</a>
          
            <a href="/tags/详解/" rel="tag">#详解</a>
          
            <a href="/tags/干货/" rel="tag">#干货</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/05/07/Android干货[原创]/Android编码规范/" rel="next" title="Android编码规范">
                <i class="fa fa-chevron-left"></i> Android编码规范
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/07/Android干货[原创]/Android干货[原创]/" rel="prev" title="Android干货[原创]说明">
                Android干货[原创]说明 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/05/07/Android干货[原创]/Android MVP 详解（下）/"
           data-title="Android MVP 详解（下）" data-url="http://diy-green.com/2016/05/07/Android干货[原创]/Android MVP 详解（下）/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/images/avatar.jpg"
               alt="DIY-green" />
          <p class="site-author-name" itemprop="name">DIY-green</p>
          <p class="site-description motion-element" itemprop="description">男子千年志，吾生未有涯。心随朗月高，志与秋霜洁。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">52</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/DIY-green" target="_blank" title="GitHub">
                  
                    <i class="fa fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/0ad0a0afc409/latest_articles" target="_blank" title="JianShu">
                  
                    <i class="fa fa-globe"></i>
                  
                  JianShu
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element">
            <div class="links-of-blogroll-title">
              <i class="fa fa-globe fa-fw"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.jianshu.com/users/0ad0a0afc409/latest_articles" title="DIY-green简书" target="_blank">DIY-green简书</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.jianshu.com/users/3a482c4f0658/latest_articles" title="天接水0001" target="_blank">天接水0001</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://sunfusheng.com" title="孙福生" target="_blank">孙福生</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://kuanggang.github.io" title="匡罡" target="_blank">匡罡</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://Ivorfason.github.io" title="尹明仁" target="_blank">尹明仁</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://mengqingxiang.github.io" title="孟庆祥" target="_blank">孟庆祥</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#5-最佳实践"><span class="nav-number">1.</span> <span class="nav-text">5. 最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-关于包结构划分"><span class="nav-number">1.1.</span> <span class="nav-text">5.1. 关于包结构划分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-关于res拆分"><span class="nav-number">1.2.</span> <span class="nav-text">5.2. 关于res拆分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-怎么写-Model"><span class="nav-number">1.3.</span> <span class="nav-text">5.3. 怎么写 Model</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-怎么写-View"><span class="nav-number">1.4.</span> <span class="nav-text">5.4. 怎么写 View</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-怎么写-Presenter"><span class="nav-number">1.5.</span> <span class="nav-text">5.5. 怎么写 Presenter</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-1-关于-Presenter-生命周期的问题"><span class="nav-number">1.5.1.</span> <span class="nav-text">5.5.1. 关于 Presenter 生命周期的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-2-关于页面跳转和显示Dialog"><span class="nav-number">1.5.2.</span> <span class="nav-text">5.5.2. 关于页面跳转和显示Dialog</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-3-一个页面多个View的问题"><span class="nav-number">1.5.3.</span> <span class="nav-text">5.5.3. 一个页面多个View的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-4-一个View有两个实现类的问题"><span class="nav-number">1.5.4.</span> <span class="nav-text">5.5.4. 一个View有两个实现类的问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-6-关于-RestAPI"><span class="nav-number">1.6.</span> <span class="nav-text">5.6. 关于 RestAPI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-7-关于项目中的常量管理"><span class="nav-number">1.7.</span> <span class="nav-text">5.7. 关于项目中的常量管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-8-关于第三方库"><span class="nav-number">1.8.</span> <span class="nav-text">5.8. 关于第三方库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-8-1-挑选第三方库的一些建议"><span class="nav-number">1.8.1.</span> <span class="nav-text">5.8.1. 挑选第三方库的一些建议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-8-2-使用第三方库尽量二次封装"><span class="nav-number">1.8.2.</span> <span class="nav-text">5.8.2. 使用第三方库尽量二次封装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-8-3-建立单独的-Module-管理所有的第三库"><span class="nav-number">1.8.3.</span> <span class="nav-text">5.8.3. 建立单独的 Module 管理所有的第三库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-9-MVP-vs-MVVM"><span class="nav-number">1.9.</span> <span class="nav-text">5.9. MVP vs MVVM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-10-Code"><span class="nav-number">1.10.</span> <span class="nav-text">5.10. Code</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-11-小结"><span class="nav-number">1.11.</span> <span class="nav-text">5.11. 小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-进阶与不足"><span class="nav-number">2.</span> <span class="nav-text">6. 进阶与不足</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-附录"><span class="nav-number">3.</span> <span class="nav-text">7. 附录</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考："><span class="nav-number">4.</span> <span class="nav-text">参考：</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DIY-green</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info powered-by">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>
<div class="powered-by">
  <span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
  </span>
</div>
<div style="display:inline-block;">
  <span id="busuanzi_container_site_uv">
    本站访客数<span id="busuanzi_value_site_uv"></span>人次
  </span>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"DIY-green"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  





  
  
  

  
  
  
  <!-- custom analytics part create by xiamo -->
<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
<script>AV.initialize("UnkeFG0pM1t3q8H3y7NTLUA0-gzGzoHsz", "2oBUu9nxByteYjLFtBtqOPwN");</script>
<script>
function showTime(Counter) {
	var query = new AV.Query(Counter);
	$(".leancloud_visitors").each(function() {
		var url = $(this).attr("id").trim();
		query.equalTo("url", url);
		query.find({
			success: function(results) {
				if (results.length == 0) {
					var content = '0 ' + $(document.getElementById(url)).text();
					$(document.getElementById(url)).text(content);
					return;
				}
				for (var i = 0; i < results.length; i++) {
					var object = results[i];
					var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
					$(document.getElementById(url)).text(content);
				}
			},
			error: function(object, error) {
				console.log("Error: " + error.code + " " + error.message);
			}
		});

	});
}

function addCount(Counter) {
	var Counter = AV.Object.extend("Counter");
	url = $(".leancloud_visitors").attr('id').trim();
	title = $(".leancloud_visitors").attr('data-flag-title').trim();
	var query = new AV.Query(Counter);
	query.equalTo("url", url);
	query.find({
		success: function(results) {
			if (results.length > 0) {
				var counter = results[0];
				counter.fetchWhenSave(true);
				counter.increment("time");
				counter.save(null, {
					success: function(counter) {
						var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
						$(document.getElementById(url)).text(content);
					},
					error: function(counter, error) {
						console.log('Failed to save Visitor num, with error message: ' + error.message);
					}
				});
			} else {
				var newcounter = new Counter();
				newcounter.set("title", title);
				newcounter.set("url", url);
				newcounter.set("time", 1);
				newcounter.save(null, {
					success: function(newcounter) {
					    console.log("newcounter.get('time')="+newcounter.get('time'));
						var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
						$(document.getElementById(url)).text(content);
					},
					error: function(newcounter, error) {
						console.log('Failed to create');
					}
				});
			}
		},
		error: function(error) {
			console.log('Error:' + error.code + " " + error.message);
		}
	});
}
$(function() {
	var Counter = AV.Object.extend("Counter");
	if ($('.leancloud_visitors').length == 1) {
		addCount(Counter);
	} else if ($('.post-title-link').length > 1) {
		showTime(Counter);
	}
}); 
</script>
  
  
</body>
</html>
